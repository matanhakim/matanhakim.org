---
title: "Analyzing Height Trends in the NBA"
subtitle: ""
author: "Matan Hakim"
date: "2023-08-10"
categories: 
  - code
  - analysis
  - NBA
  - RWeekly Highlights
image: "image.png"
---

# Code

```{r}
library(tidyverse)
library(rvest)
library(janitor)
library(nbastatR)
library(conflicted)
conflicts_prefer(dplyr::filter())
```

## Read total minutes played for every player in every season

```{r}
read_season <- function(year) {
  Sys.sleep(4)
  read_html(str_c("https://www.basketball-reference.com/leagues/NBA_", year, "_totals.html")) |> 
    html_element("table") |> 
    html_table() |> 
    clean_names() |> 
    filter(str_detect(rk, "[:digit:]")) |> 
    select(player, pos, age, mp) |> 
    mutate(player = str_remove_all(player, "\\*"))
}
```

```{r}
df_all <- tibble(year = 1950:2023) |> 
  mutate(data = map(year, read_season)) |> 
  unnest(data)
```

```{r}
write_csv(df_all, "data/seasons.csv")
```

## Read all players

```{r}
read_players_letter <- function(letter) {
  Sys.sleep(4)
  read_html(str_c("https://www.basketball-reference.com/players/", letter)) |> 
    html_element("table") |> 
    html_table() |> 
    clean_names() |> 
    filter(str_detect(from, "[:digit:]")) |> 
    mutate(player = str_remove_all(player, "\\*"))
}
```

```{r}
letters_no_x <- letters[letters != "x"]
df_players <- map(letters_no_x, read_players_letter) |> 
  list_rbind()
```

```{r}
df_players <- df_players |> 
  separate(ht, into = c("ht_feet", "ht_inches"), sep = "-") |> 
  mutate(
    ht_tot_inches = parse_number(ht_feet) * 12 + parse_number(ht_inches),
    ht_tot_cm = ht_tot_inches * 2.54,
    birth_date = parse_date_time(birth_date, "bdy")
  )
```

